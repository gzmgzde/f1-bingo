<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 Qatar GP Bingo</title>
<style>
  body { font-family: Arial; background: #111; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px; }
  h1 { color: #ff4d4d; text-align: center; margin-bottom: 10px; }
  #board { display: grid; grid-template-columns: repeat(3, 120px); grid-template-rows: repeat(3, 120px); gap: 10px; margin-top: 20px; aspect-ratio: 1 / 1;}
  .cell { display: flex; align-items: center; justify-content: center; padding: 10px; background: #222; border: 1px solid #444; border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s; font-size: 14px; word-wrap: break-word;
  overflow-wrap: break-word; white-space: normal; aspect-ratio: 1 / 1;}
  .cell:hover { background: #333; }
  .marked { background: #ff4d4d; color: #000; font-weight: bold; animation: bounce 0.3s ease; }
  .winner { background: #00ff00 !important; color: #000; font-weight: bold; animation: glow 1s infinite alternate; }

  @keyframes glow {
    0% { box-shadow: 0 0 5px #00ff00; }
    50% { box-shadow: 0 0 20px #00ff00; }
    100% { box-shadow: 0 0 5px #00ff00; }
  }

  @keyframes bounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  button { padding: 10px 20px; margin-top: 20px; background: #ff4d4d; color: #000; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
  #usernameInput { padding: 8px; font-size: 14px; border-radius: 4px; border: 1px solid #444; margin-bottom: 10px; }

  #leaderboardContainer {
  width: 280px;
  background: #1a1a1a;
  padding: 15px;
  border-radius: 10px;
  margin-top: 20px;
  box-shadow: 0 0 10px rgba(255, 77, 77, 0.3);
}

#leaderboardTitle {
  text-align: center;
  color: #ff4d4d;
  font-weight: bold;
  margin-bottom: 10px;
}

#leaderboard li {
  padding: 8px 10px;
  margin-bottom: 6px;
  background: #222;
  border-radius: 6px;
  list-style: none;
  display: flex;
  align-items: center;
  gap: 8px;
  animation: slideIn 0.3s ease;
}

#leaderboard li:hover {
  background: #333;
  transform: scale(1.03);
  transition: 0.2s;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

.trophy-1 { color: gold; }
.trophy-2 { color: silver; }
.trophy-3 { color: #cd7f32; } /* bronze */

</style>
</head>
<body>
<h1>F1 Qatar GP Bingo</h1>
<input id="usernameInput" type="text" placeholder="Enter your username" />
<p>Tap squares to mark them. 3 in a row wins!</p>

<button onclick="resetMarks()">Reset Marks</button>
<div id="board"></div>
<div id="leaderboardContainer">
  <h2 id="leaderboardTitle">Leaderboard</h2>
  <ul id="leaderboard"></ul>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA0lUuOnAq8N4sn6WpPr5evS3-sYwXfyu4",
  authDomain: "f1-bingo-7c7d4.firebaseapp.com",
  projectId: "f1-bingo-7c7d4",
  storageBucket: "f1-bingo-7c7d4.appspot.com",
  messagingSenderId: "167693372774",
  appId: "1:167693372774:web:11afc0fd34166a437d8ca7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const leaderboard = document.getElementById('leaderboard');

db.collection('winners')
  .orderBy('timestamp')
  .onSnapshot(snapshot => {

    leaderboard.innerHTML = '';
    let rank = 1;

    snapshot.forEach(doc => {
      const li = document.createElement('li');
      
      let trophy = "";
      if (rank === 1) trophy = "üèÜ";
      if (rank === 2) trophy = "ü•à";
      if (rank === 3) trophy = "ü•â";

      li.innerHTML = `<span>${trophy}</span> ${doc.id}`;
      leaderboard.appendChild(li);
      rank++;
    });
});

const items = [
  "Safety Car","Virtual Safety Car","DRS train","Track limits violation",
  "Time penalty","Pit stop <2.5s","Pit stop >5s",
  "Runs wide Turn 1","Yuki screaming on the radio","Stroll DNF","Max fastest lap",
  "Lando radio complaint","Leclerc blame","Alpine having stinker",
  "Sand on track","Stroll commits track terrorism","Haas Double Points",
  "Undercut attempt","Switch to hards","Fans on camera",
  "Multiple teams try a 3-stop strategy","Partner on camera","Ferrari pit stop goes wrong",
  "Yellow flag","Lando loses a podium because of tyre wear","Helmet cam","Slow pit exit",
  "Pit lane traffic","Wheel-to-wheel fight", "Max complains about tyre-wear",
  "Lawson quietly finishes P8", "Presenters talk about how well the circuit looks ‚Äúunder the lights‚Äù",
  "3-grid penalty for something minor", "Ferrari confuse strategies between drivers",
  "Radio message from engineer that sounds like a threat"
];
let boardCells = [], boardDisabled = false;

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function generateBoard(){
  const board = document.getElementById("board");
  board.innerHTML = "";
  boardCells = [];
  boardDisabled = false;
  const card = shuffle([...items]).slice(0,9);
  card.forEach((text,index)=>{
    const cell=document.createElement("div");
    cell.className="cell";
    cell.textContent=text;
    cell.dataset.index=index;
    cell.onclick = ()=>{ if(!boardDisabled) toggleMark(cell); };
    board.appendChild(cell);
    boardCells.push(cell);
  });
}

let activeType = 'row'; // 'row' or 'column'
let completedLines = []; // track completed lines

function toggleMark(cell){
  const username = document.getElementById('usernameInput').value.trim();
  if(!username){ alert('Enter username!'); return; }
  if(boardDisabled) return;

  cell.classList.toggle("marked");

  if(!activeType){
    const index = parseInt(cell.dataset.index);
    const rowIndex = Math.floor(index / 3);
    const colIndex = index % 3;
  }

  checkLines(username);
}

function checkLines(username){
  const indices = boardCells.map(cell => cell.classList.contains('marked') ? 1 : 0);

  // Define lines based on active type
  let lines = [];
  if(activeType === 'row'){
    lines = [
      { combo: [0,1,2], name: "Line" },
      { combo: [3,4,5], name: "Line" },
      { combo: [6,7,8], name: "Line" }
    ];
  } else if(activeType === 'column'){
    lines = [
      { combo: [0,3,6], name: "Column" },
      { combo: [1,4,7], name: "Column" },
      { combo: [2,5,8], name: "Column" }
    ];
  }

  lines.forEach(line => {
    if(line.combo.every(i => indices[i] === 1) && !completedLines.includes(line.name)){
      completedLines.push(line.name);
      line.combo.forEach(i => boardCells[i].classList.add('winner'));

      if(completedLines.length < 3){
        alert(`${username} completed ${line.name}!`);
      } else {
        alert(`${username} completed ${line.name}, Bingo! üéâ`);
        boardDisabled = true;
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        saveResult(username);
      }
    }
  });
}

function resetMarks(){
  boardCells.forEach(c=>c.classList.remove('marked','winner'));
  boardDisabled = false;
  completedLines = [];
  activeType = null;
}



function saveResult(username){
  const winnerRef = db.collection('winners').doc(username);
  winnerRef.get().then(docSnapshot=>{
    if(!docSnapshot.exists){
      winnerRef.set({ timestamp: Date.now() });
    } else {
      alert(username+" already has a win recorded!");
    }
  });
}

generateBoard();
</script>
</body>
</html>
