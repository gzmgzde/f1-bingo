<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F1 Qatar GP Bingo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      color: #ff4d4d;
      text-align: center;
      margin-bottom: 10px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(3, 120px);
      grid-template-rows: repeat(3, 120px);
      gap: 10px;
      margin-top: 20px;
    }
    .cell {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: #222;
      border: 1px solid #444;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: 0.2s;
      font-size: 14px;
    }
    .cell:hover { background: #333; }
    .marked {
      background: #ff4d4d;
      color: #000;
      font-weight: bold;
    }
    button {
      padding: 10px 20px;
      margin-top: 20px;
      background: #ff4d4d;
      color: #000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    #usernameInput {
      padding: 8px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #444;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>F1 Qatar GP Bingo</h1>
  <input id="usernameInput" type="text" placeholder="Enter your username" />
  <p>Tap squares to mark them. 3 in a row wins!</p>

  <div id="board"></div>

  <h2>Leaderboard</h2>
  <ul id="leaderboard"></ul>

  <button onclick="resetMarks()">Reset Marks</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Leaderboard DOM element
    const leaderboard = document.getElementById('leaderboard');

    // Listen for winners in real-time
    db.ref('winners').on('value', snapshot => {
      leaderboard.innerHTML = '';
      const winnersArray = [];
      snapshot.forEach(child => winnersArray.push(child.val()));
      winnersArray.sort((a, b) => a.timestamp - b.timestamp);
      winnersArray.forEach((winner, index) => {
        const li = document.createElement('li');
        li.textContent = `${index + 1}. ${winner.username}`;
        leaderboard.appendChild(li);
      });
    });

    // Bingo items
    const items = [
      "Safety Car", "Virtual Safety Car", "DRS train", "Track limits violation",
      "Time penalty", "Tyre complaint", "Pit stop <2.5s", "Pit stop >5s",
      "Runs wide Turn 1", "Team orders", "Driver retires (DNF)", "Max fastest lap",
      "Lando radio complaint", "Russell/Leclerc blame", "Checo penalty",
      "Lewis coaching moment", "Oscar quiet radio", "Tyre blistering",
      "Undercut attempt", "Switch to hards", "Fans on camera",
      "Kids with earmuffs", "Partner on camera", "Team banner",
      "Yellow flag", "Lock-up", "Helmet cam", "Slow pit exit",
      "Pit lane traffic", "Wheel-to-wheel fight"
    ];

    let boardCells = [];

    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    // Generate board once
    function generateBoard() {
      const board = document.getElementById("board");
      board.innerHTML = "";
      boardCells = [];

      const card = shuffle([...items]).slice(0, 9);
      card.forEach((text, index) => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = text;
        cell.dataset.index = index;
        cell.onclick = () => toggleMark(cell);
        board.appendChild(cell);
        boardCells.push(cell);
      });
    }

    function toggleMark(cell) {
      const username = document.getElementById('usernameInput').value.trim();
      if (!username) {
        alert('Please enter a username!');
        return;
      }
      cell.classList.toggle("marked");
      checkWinner(username);
    }

    function checkWinner(username) {
      const winCombos = [
        [0,1,2], [3,4,5], [6,7,8], // rows
        [0,3,6], [1,4,7], [2,5,8], // columns
        [0,4,8], [2,4,6] // diagonals
      ];

      for (const combo of winCombos) {
        if (combo.every(i => boardCells[i].classList.contains('marked'))) {
          alert(username + ' wins! ðŸŽ‰');
          saveResult(username);
          return;
        }
      }
    }

    function resetMarks() {
      boardCells.forEach(cell => cell.classList.remove('marked'));
    }

    function saveResult(username) {
      db.ref('winners').push({
        username: username,
        timestamp: Date.now()
      });
    }

    // Initialize board
    generateBoard();
  </script>
</body>
</html>
