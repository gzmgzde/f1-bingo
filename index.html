<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 Qatar GP Bingo</title>
<style>
  body { font-family: Arial; background: #111; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px; }
  h1 { color: #ff4d4d; text-align: center; margin-bottom: 10px; }
  #board { display: grid; grid-template-columns: repeat(3, 120px); grid-template-rows: repeat(3, 120px); gap: 10px; margin-top: 20px; aspect-ratio: 1 / 1;}
  .cell { display: flex; align-items: center; justify-content: center; padding: 10px; background: #222; border: 1px solid #444; border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s; font-size: 14px; word-wrap: break-word;
  overflow-wrap: break-word; white-space: normal; aspect-ratio: 1 / 1;}
  .cell:hover { background: #333; }
  .marked { background: #ff4d4d; color: #000; font-weight: bold; animation: bounce 0.3s ease; }
  .winner { background: #00ff00 !important; color: #000; font-weight: bold; animation: glow 1s infinite alternate; }

  @keyframes glow {
    0% { box-shadow: 0 0 5px #00ff00; }
    50% { box-shadow: 0 0 20px #00ff00; }
    100% { box-shadow: 0 0 5px #00ff00; }
  }

  @keyframes bounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  button { padding: 10px 20px; margin-top: 20px; background: #ff4d4d; color: #000; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
  #usernameInput { padding: 8px; font-size: 14px; border-radius: 4px; border: 1px solid #444; margin-bottom: 10px; }

  #leaderboardContainer {
  width: 280px;
  background: #1a1a1a;
  padding: 15px;
  border-radius: 10px;
  margin-top: 20px;
  box-shadow: 0 0 10px rgba(255, 77, 77, 0.3);
}

#leaderboardTitle {
  text-align: center;
  color: #ff4d4d;
  font-weight: bold;
  margin-bottom: 10px;
}

#leaderboard li {
  padding: 8px 10px;
  margin-bottom: 6px;
  background: #222;
  border-radius: 6px;
  list-style: none;
  display: flex;
  align-items: center;
  gap: 8px;
  animation: slideIn 0.3s ease;
}

#leaderboard li:hover {
  background: #333;
  transform: scale(1.03);
  transition: 0.2s;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

.trophy-1 { color: gold; }
.trophy-2 { color: silver; }
.trophy-3 { color: #cd7f32; } /* bronze */

</style>
</head>
<body>
<h1>F1 Qatar GP Bingo</h1>
<input id="usernameInput" type="text" placeholder="Enter your username" />
<p>Tap squares to mark them. 3 in a row wins!</p>

<button onclick="resetMarks()">Reset Marks</button>
<div id="board"></div>
<div id="leaderboardContainer">
  <h2 id="leaderboardTitle">Leaderboard</h2>
  <ul id="leaderboard"></ul>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA0lUuOnAq8N4sn6WpPr5evS3-sYwXfyu4",
  authDomain: "f1-bingo-7c7d4.firebaseapp.com",
  projectId: "f1-bingo-7c7d4",
  storageBucket: "f1-bingo-7c7d4.appspot.com",
  messagingSenderId: "167693372774",
  appId: "1:167693372774:web:11afc0fd34166a437d8ca7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const leaderboard = document.getElementById('leaderboard');

db.collection('winners')
  .orderBy('timestamp')
  .onSnapshot(snapshot => {

    leaderboard.innerHTML = '';
    let rank = 1;

    snapshot.forEach(doc => {
      const li = document.createElement('li');
      
      let trophy = "";
      if (rank === 1) trophy = "üèÜ";
      if (rank === 2) trophy = "ü•à";
      if (rank === 3) trophy = "ü•â";

      li.innerHTML = `<span>${trophy}</span> ${doc.id}`;
      leaderboard.appendChild(li);
      rank++;
    });
});

const items = [
  "Safety Car","Virtual Safety Car","DRS train","Track limits violation",
  "Time penalty","Pit stop <2.5s","Pit stop >5s",
  "Runs wide Turn 1","Yuki screaming on the radio","Stroll DNF","Max fastest lap",
  "Lando radio complaint","Leclerc blame","Alpine having stinker",
  "Sand on track","Stroll commits track terrorism","Haas Double Points",
  "Undercut attempt","Switch to hards","Fans on camera",
  "Multiple teams try a 3-stop strategy","Partner on camera","Ferrari pit stop goes wrong",
  "Yellow flag","Lando loses a podium because of tyre wear","Helmet cam","Slow pit exit",
  "Pit lane traffic","Wheel-to-wheel fight", "Max complains about tyre-wear",
  "Lawson quietly finishes P8", "Presenters talk about how well the circuit looks ‚Äúunder the lights‚Äù",
  "3-grid penalty for something minor", "Ferrari confuse strategies between drivers",
  "Radio message from engineer that sounds like a threat"
];
let boardCells = [], boardDisabled = false;

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function generateBoard(){
  const board = document.getElementById("board");
  board.innerHTML = "";
  boardCells = [];
  boardDisabled = false;
  const card = shuffle([...items]).slice(0,9);
  card.forEach((text,index)=>{
    const cell=document.createElement("div");
    cell.className="cell";
    cell.textContent=text;
    cell.dataset.index=index;
    cell.onclick = ()=>{ if(!boardDisabled) toggleMark(cell); };
    board.appendChild(cell);
    boardCells.push(cell);
  });
}

let activeType = null; 
let completedLines = []; 

ffunction toggleMark(cell){
  const username = document.getElementById('usernameInput').value.trim();
  if(!username){ alert('Enter username!'); return; }
  if(boardDisabled) return;

  cell.classList.toggle("marked");

  const index = parseInt(cell.dataset.index);
  const row = Math.floor(index / 3);
  const col = index % 3;

  // Detect FIRST move only
  if(activeType === null){
    const rowMarks =
      [row*3, row*3+1, row*3+2].filter(i => boardCells[i].classList.contains("marked")).length;

    const colMarks =
      [col, col+3, col+6].filter(i => boardCells[i].classList.contains("marked")).length;

    // Whichever has more marks determines the style
    if(colMarks > rowMarks) activeType = "column";
    else activeType = "row"; // default
  }

  checkLines(username);
}


function checkLines(username){
  const marked = boardCells.map(c => c.classList.contains("marked"));

  let lines = [];

  if(activeType === "row"){
    lines = [
      { id: "r0", combo: [0,1,2] },
      { id: "r1", combo: [3,4,5] },
      { id: "r2", combo: [6,7,8] }
    ];
  }

  if(activeType === "column"){
    lines = [
      { id: "c0", combo: [0,3,6] },
      { id: "c1", combo: [1,4,7] },
      { id: "c2", combo: [2,5,8] }
    ];
  }

  lines.forEach(line => {

    const isComplete = line.combo.every(i => marked[i]);
    const alreadyDone = completedLines.includes(line.id);

    if(isComplete && !alreadyDone){

      completedLines.push(line.id);

      // Highlight winners
      line.combo.forEach(i => boardCells[i].classList.add("winner"));

      if(completedLines.length < 3){
        alert(`${username} completed ${activeType} ${completedLines.length}!`);
      } else {
        alert(`${username} completed all 3 ${activeType}s ‚Äî BINGO! üéâ`);
        boardDisabled = true;
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        saveResult(username);
      }
    }
  });
}


function resetMarks(){
  boardCells.forEach(c=>c.classList.remove('marked','winner'));
  boardDisabled = false;
  completedLines = [];
  activeType = null;  // important!
}


function saveResult(username){
  const winnerRef = db.collection('winners').doc(username);
  winnerRef.get().then(docSnapshot=>{
    if(!docSnapshot.exists){
      winnerRef.set({ timestamp: Date.now() });
    } else {
      alert(username+" already has a win recorded!");
    }
  });
}

generateBoard();
</script>
</body>
</html>
